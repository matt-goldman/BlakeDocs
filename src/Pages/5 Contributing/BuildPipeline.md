---
title: 'Build Pipeline'
date: 2025-07-27
image: images/blake-logo.png
tags: []
description: Understand Blake's core rendering pipeline and how content is processed.
iconIdentifier: "bi bi-plus-square-fill-nav-menu"
pageOrder: 1
category: "Contributing"
---

:::summary
Blake's build pipeline "bakes" Markdown and templates into Razor, through a three-stage process. Each stage can be manipulated by plugins to influence or transform the baked results.
:::

## Build stages

Blake builds your content through a three-stage process:

| **Stage**          | **Explanation**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1. Before bake** | Code is executed prior to generating the Razor output based on the Markdown and template inputs. Plugins can execute code before the Razor content is generated. This is useful for things like adding metadata to frontmatter (see below), or otherwise manipulating the content before it is rendered.                                                                                                                                                                                                                                                                                                                           |
| **2. Bake**        | This is the process of actually generating the Razor files. This happens in two sub-stages: first, Markdig is used to render HTML from the Markdown content. After that, the Razor file content is generated by replacing `@Body` in the template with the output from the Markdig pipeline, as well as replacing any known placeholders from the frontmatter, or custom metadata in the frontmatter (see below). Finally, the output path is also determined based on the folder structure. Plugins can extend this stage by registering Markdig extensions with the pipeline, but no other part of this stage can be controlled. |
| **3. After bake**  | After the razor content is generated, plugins can run code by hooking into the after bake lifecycle hook. This can be useful for manipulating the generated Razor content, generating additional files based on the resulting content, or other operations that rely on the baking process completing first.                                                                                                                                                                                                                                                                                                                       |

After all loaded plugins' `AfterBakeAsync` methods have been called, the `GeneratedContentIndex` is created, and the final content is written out to Razor files in the `.generated` folder.

## Blake Context

A `BlakeContext` type is constructed prior to baking, and is passed along the pipeline. `BlakeContext` is populated initially with all the Markdown content and metadata about the project including the project name, root path, and CLI arguments passed to `bake`. It also includes an instance of `MarkdownPipelineBuilder` (from Markdig).

`BlakeContext` is passed into both lifecycle methods. Plugins can access the raw Markdown content in either, but the generated Razor pages are not present in the before bake method. Custom Markdig extensions should be registered in the `BeforeBakeAsync` method. Here's an example from the DosRenderer plugin:

```csharp
public Task BeforeBakeAsync(BlakeContext context, ILogger? logger = null)
{
    // This method is called before the bake process starts
    // You can add any pre-bake logic here if needed

    logger?.LogInformation("[BlakePlugin.DocsRenderer] BeforeBakeAsync called.");

    context.PipelineBuilder
        .UsePrism(_options, logger)     // The docs renderer contains custom Prism extensions for syntax highlighting
        .UseDocumentSections(logger);   // UseDocumentSections is a Markdig extension that registers a custom pipeline renderer

    return Task.CompletedTask;
}
```

Plugins can access the generated Razor content in the `BlakeContext` in the `AfterBaeAsync` method.

## Plugin lifecycle

Note that it is **not possible** to control the execution order of plugins. Blake loads them based on OS defined criteria that you cannot control as a plugin author. Therefore it is important to treat all before bake and after bake operations as atomic and independent.

Plugins are stateless - it is also not possible to directly pass data between the before bake and after bake methods. Workarounds exist, such as encoding data in structured comments in the Markdown (see the section on authoring plugins for more details).

## Metadata and frontmatter

Blake uses frontmatter to add metadata to your pages. This metadata can include things like titles, descriptions, and other information that you want to associate with your content. The frontmatter is written in YAML format at the top of your Markdown files, and Blake processes this information to generate structured access to your pages. There are some predefined values in the `PageModel` type, but you can add anything you like to your frontmatter. Any keys not recognised as `PageModel` properties are added to a `Dictionary` on the `PageModel` called `Metadata`.

## Generated content index

Blake generates a `GeneratedContentIndex` that provides structured access to all the pages in your site. This index allows you to easily navigate and manage your content, making it simple to find and link to pages within your site.

When initialising a Blake site, if you include the sample content, you can see how the `GeneratedContentIndex` can be used for dynamic navigation.

Additionally, because `PageModel` includes a title, description, and tags, you can easily add rudimentary search functionality to your site. This can be done by iterating over the `GeneratedContentIndex` and filtering based on the user's input. Blake doesn't support full text search - that's outside the scope of the core Blake functionality (and likely outside the requirements of many static sites). However, as a Blake site is just a Blazor site, it's possible to add this - and there's a planned plugin that will support it too.

## Draft pages

Blake supports draft pages, which are pages that are not yet ready for publication. You can mark a page as a draft by adding `draft: true` to the frontmatter. Draft pages will not be included in the generated content index or the final output, allowing you to work on them without affecting your live site.

### Future Dated Posts - The Blake difference

With Blake, you can choose to bake or not bake draft pages, but what about timed publication/release? This was one of my main frustratitions with other static site generators, and one of the core motivations for creating Blake.

Typically, this functionality requires a CMS, and it's easy to see why - if you bake an SSG, the content is there, and you can't change it without rebaking.

Blake doesn't change this, but it _does_ provide a cool, minimal workaround: use the publication date.

Looking at Jekyll for contrast, you can include `date: 2025-07-27` in your frontmatter, and by default, anything future-dated is not included in the generated site. You can use a CLI flag or configuration to change this, and that's useful for local previewing, but it doesn't allow you to control a release.

With Blake, it's simple: just include `date: 2025-07-27` in your frontmatter, and _filter your navigation by date_. Because the date is part of the `PageModel`, you can easily filter your navigation to only include pages with a date in the past. This allows you to control the visibility of pages based on their publication date without needing to rebake your site, while still making them available to preview, either for yourself or other reviewers.

Granted, this does not restrict access to the page itself, only hides it from the navigation. But this is a static site - if you need access control, a static site is not the right tool. For nearly all circumstances, this provides a simple and effective way to manage content publication without the need for a complex CMS or additional tooling.

:::note
If you are using the RSS and OpenGraph plugins, note that these generate static content too. So if you future-date something, it won't be visible in your site navigation (if you follow the above example) but it will show up in your site metadata.
:::
